<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><title>Visual Studio Code</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://vscode-doc-jp.github.io/docs/extensions/patterns-and-principles.html"><link rel="stylesheet" href="/css/navy.css"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"><link rel="alternate" href="/atom.xml" title="Visual Studio Code"></head><body><div id="container"><header id="header" class="wrapper"><div id="header-inner" class="inner"><h1 id="logo-wrap"><a href="/" id="logo">Visual Studio Code</a></h1><nav id="main-nav"><a href="/docs/" class="main-nav-link">Docs</a><a href="/updates/" class="main-nav-link">Updates</a><div id="search-input-wrap"><div id="search-input-icon"><i class="fa fa-search"></i></div><input type="search" id="search-input" placeholder="Search..."></div></nav><a id="mobile-nav-toggle"><span class="mobile-nav-toggle-bar"></span> <span class="mobile-nav-toggle-bar"></span> <span class="mobile-nav-toggle-bar"></span></a></div></header><div id="content-wrap"><div id="content" class="wrapper"><div id="content-inner"><article class="article-container" itemscope itemtype="http://schema.org/Article"><div class="article-inner"><div class="article"><div class="inner"><header class="article-header"><h1 class="article-title" itemprop="name"></h1><a href="https://github.com/EbXpJ6bp/doc-vscode/edit/master/docs/extensions/patterns-and-principles.md" class="article-edit-link" title="Improve this doc"><i class="fa fa-pencil"></i></a><h2><time class="article-updated" data-position="header" datetime="2017-02-03T07:14:16.084Z" itemprop="dateModified">Last updated: 2017-02-03</time></h2></header><div class="article-content" itemprop="articleBody"><h1 id="Extensibility-Principles-and-Patterns" class="article-heading"><a href="#Extensibility-Principles-and-Patterns" class="headerlink" title="Extensibility Principles and Patterns"></a>Extensibility Principles and Patterns<a class="article-anchor" href="#Extensibility-Principles-and-Patterns" aria-hidden="true"></a></h1><p>The extension API of Visual Studio Code follows some guiding patterns and principles which are applied throughout the whole API.</p><h2 id="Promises" class="article-heading"><a href="#Promises" class="headerlink" title="Promises"></a>Promises<a class="article-anchor" href="#Promises" aria-hidden="true"></a></h2><p>The VS Code API represents asynchronous operations with <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="external">promises</a>. From extensions, <strong>any</strong> type of promise can be returned, like ES6, WinJS, A+, etc.</p><p>Being independent of a specific promise library is expressed in the API by the <code>Thenable</code>-type. <code>Thenable</code> represents the common denominator which is the <code>then</code>-property.</p><p>In most cases the use of promises is optional and when VS Code calls into an extension, it can handle the <em>result type</em> as well as a <code>Thenable</code> of the <em>result type</em>. When the use of a promise is optional, the API indicates this by returning <code>or</code>-types.</p><figure class="highlight typescript"><table><tr><td class="code"><pre><div class="line">	provideNumber(): <span class="built_in">number</span> | Thenable&lt;<span class="built_in">number</span>&gt;</div><div class="line"><span class="string">``</span><span class="string">`	</span></div><div class="line"></div><div class="line">## Cancellation Tokens</div><div class="line"></div><div class="line">Often operations are started on volatile state which changes before operations can finish. For instance, computing IntelliSense starts and the user continues to type making the result of that operation obsolete. </div><div class="line"></div><div class="line">APIs that are exposed to such behavior will get passed a `CancellationToken<span class="string">` on which you can check for cancellation (`</span>isCancellationRequested<span class="string">`) or get notified when cancellation occurs (`</span>onCancellationRequested<span class="string">`). The cancellation token is usually the last parameter of a function call and optional. </span></div><div class="line"></div><div class="line">## Disposables</div><div class="line"></div><div class="line">The VS Code API uses the [dispose pattern](https://en.wikipedia.org/wiki/Dispose_pattern) for resources that are obtained from VS Code. This applies to event listening, commands, interacting with the UI, and various language contributions. </div><div class="line"></div><div class="line">For instance, the `setStatusBarMessage(value: <span class="built_in">string</span>)<span class="string">` function returns a `</span>Disposable<span class="string">` which upon calling `</span>dispose<span class="string">` removes the message again.</span></div><div class="line"></div><div class="line">## Events</div><div class="line"></div><div class="line">Events in the VS Code API are exposed as functions which you call with a listener-function to subscribe. Calls to subscribe return a `Disposable<span class="string">` which removes the event listener upon dispose. </span></div><div class="line"></div><div class="line">`<span class="string">``</span>javascript</div><div class="line"><span class="keyword">var</span> listener = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">"It happened"</span>, event);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// start listening</span></div><div class="line"><span class="keyword">var</span> subscription = fsWatcher.onDidDelete(listener);</div><div class="line"></div><div class="line"><span class="comment">// do more stuff</span></div><div class="line"></div><div class="line">subscriptions.dispose(); <span class="comment">// stop listening</span></div></pre></td></tr></table></figure><p>Names of events follow the <code>on[Will|Did]VerbNoun?</code> pattern. The name signals if the event is going to happens <em>(onWill)</em> or already happened <em>(onDid)</em>, what happened <em>(verb)</em>, and the context <em>(noun)</em> unless obvious from the context.</p><p>An example from the VS Code API is <code>window.onDidChangeActiveTextEditor</code> which is an event fired when the active text editor <em>(noun)</em> has been (<em>onDid</em>) changed (<em>verb</em>).</p><h2 id="Using-Node-js-Modules-with-Extensions" class="article-heading"><a href="#Using-Node-js-Modules-with-Extensions" class="headerlink" title="Using Node.js Modules with Extensions"></a>Using Node.js Modules with Extensions<a class="article-anchor" href="#Using-Node-js-Modules-with-Extensions" aria-hidden="true"></a></h2><p>Your extension can depend on <a href="https://nodejs.org" target="_blank" rel="external">Node.js</a> modules at runtime. Similarly to a node module itself, you can add those dependencies to your <a href="/docs/extensionAPI/extension-manifest.html"><code>package.json</code> extension manifest</a> using the <code>dependencies</code> field.</p><h3 id="Installation-and-Packaging" class="article-heading"><a href="#Installation-and-Packaging" class="headerlink" title="Installation and Packaging"></a>Installation and Packaging<a class="article-anchor" href="#Installation-and-Packaging" aria-hidden="true"></a></h3><p>Visual Studio Code <strong>will not</strong> install your extension’s dependencies when a user installs it, so you must <code>npm install</code> before publishing. The extension’s publishing package will contain all of its dependencies within. You can run <code>vsce ls</code> to list all the files that <code>vsce</code> will include in the package.</p><p>You can create a <code>.vscodeignore</code> file to exclude some files from being included in your extension’s package. See the <code>vsce</code> publishing tool topic for <a href="https://code.visualstudio.com/docs/tools/vscecli.md#vscodeignore" target="_blank" rel="external">details</a> about using a <code>.vscodeignore</code> file.</p><h2 id="Next-Steps" class="article-heading"><a href="#Next-Steps" class="headerlink" title="Next Steps"></a>Next Steps<a class="article-anchor" href="#Next-Steps" aria-hidden="true"></a></h2><ul><li><a href="/docs/extensionAPI/extension-manifest.html">Extension Manifest File</a> - VS Code package.json extension manifest file reference</li><li><a href="/docs/extensionAPI/extension-points.html">Contribution Points</a> - VS Code contribution points reference</li><li><a href="/docs/extensionAPI/activation-events.html">Activation Events</a> - VS Code activation events reference</li></ul><h2 id="Common-Questions" class="article-heading"><a href="#Common-Questions" class="headerlink" title="Common Questions"></a>Common Questions<a class="article-anchor" href="#Common-Questions" aria-hidden="true"></a></h2><p><strong>Q: Can I use native Node.js modules with my extension?</strong></p><p><strong>A:</strong> A Visual Studio Code extension package contains all of its dependencies. This means that if you develop your extension on Windows and depend on a native Node.js module when you publish that extension, the Windows compiled native dependency will be contained in your extension. Users on Mac or Linux won’t be able to use the extension.</p><p>The only way to make this work for now is to include binaries for all four platforms of VS Code (Windows x86 and x64, Linux, Mac) in your extension and have code that dynamically loads the right one.</p><p>We don’t recommend extensions use native <code>npm</code> modules as native modules bundled with an extension must be recompiled with every new version of VS Code against the same Node.js version that VS Code ships with. You can find the Node.js and module versions by running <code>process.versions</code> from the developer tools console (<strong>Help</strong> &gt; <strong>Toggle Developer Tools</strong>).</p></div><footer class="article-footer"><time class="article-updated" datetime="2017-02-03T07:14:16.084Z" itemprop="dateModified">Last updated: 2017-02-03</time></footer></div></div><aside id="article-toc" role="navigation"><div id="article-toc-inner"><strong class="sidebar-title">Contents</strong><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Extensibility-Principles-and-Patterns"><span class="toc-text">Extensibility Principles and Patterns</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Promises"><span class="toc-text">Promises</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Using-Node-js-Modules-with-Extensions"><span class="toc-text">Using Node.js Modules with Extensions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Installation-and-Packaging"><span class="toc-text">Installation and Packaging</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Next-Steps"><span class="toc-text">Next Steps</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Common-Questions"><span class="toc-text">Common Questions</span></a></li></ol></li></ol><a href="#" id="article-toc-top">Back to Top</a></div></aside></div></article><aside id="sidebar" role="navigation"><div class="inner"><strong class="sidebar-title">Getting Started</strong><a href="/docs/index.html" class="sidebar-link">Overview</a><strong class="sidebar-title">SETUP</strong><a href="/docs/setup/setup-overview.html" class="sidebar-link">Overview</a><a href="/docs/setup/windows.html" class="sidebar-link">Windows</a><a href="/docs/setup/additional-components.html" class="sidebar-link">Additional Components</a><strong class="sidebar-title">EDITOR</strong><a href="/docs/editor/intellisense.html" class="sidebar-link">IntelliSense</a><a href="/docs/editor/versioncontrol.html" class="sidebar-link">Version Control</a><a href="/docs/editor/accessibility.html" class="sidebar-link">Accessibility</a><strong class="sidebar-title">CUSTOMIZATION</strong><a href="/docs/customization/overview.html" class="sidebar-link">Overview</a><a href="/docs/customization/userandworkspace.html" class="sidebar-link">User and Workspace Settings</a><a href="/docs/customization/locales.html" class="sidebar-link">Display Language</a><strong class="sidebar-title">LANGUAGES</strong><a href="/docs/languages/overview.html" class="sidebar-link">Overview</a><a href="/docs/languages/html.html" class="sidebar-link">HTML</a><strong class="sidebar-title">RUNTIMES</strong><a href="/hoge.html" class="sidebar-link">none</a><strong class="sidebar-title">EXTENSION AUTHORING</strong><a href="/hoge.html" class="sidebar-link">none</a><strong class="sidebar-title">EXTENSIBILITY REFERENCE</strong><a href="/hoge.html" class="sidebar-link">none</a><strong class="sidebar-title">SUPPORTING</strong><a href="/docs/supporting/errors.html" class="sidebar-link">Errors</a><a href="/docs/supporting/faq.html" class="sidebar-link">FAQ</a><a href="/docs/supporting/requirements.html" class="sidebar-link">Requirements</a><strong class="sidebar-title">TOOLS</strong><a href="/hoge.html" class="sidebar-link">none</a></div></aside></div></div></div></div><div id="mobile-nav-dimmer"></div><nav id="mobile-nav"><div id="mobile-nav-inner"><ul id="mobile-nav-list"><a href="/docs/" class="mobile-nav-link">Docs</a><a href="/updates/" class="mobile-nav-link">Updates</a></ul><strong class="mobile-nav-title">Getting Started</strong><a href="/docs/index.html" class="mobile-nav-link">Overview</a><strong class="mobile-nav-title">SETUP</strong><a href="/docs/setup/setup-overview.html" class="mobile-nav-link">Overview</a><a href="/docs/setup/windows.html" class="mobile-nav-link">Windows</a><a href="/docs/setup/additional-components.html" class="mobile-nav-link">Additional Components</a><strong class="mobile-nav-title">EDITOR</strong><a href="/docs/editor/intellisense.html" class="mobile-nav-link">IntelliSense</a><a href="/docs/editor/versioncontrol.html" class="mobile-nav-link">Version Control</a><a href="/docs/editor/accessibility.html" class="mobile-nav-link">Accessibility</a><strong class="mobile-nav-title">CUSTOMIZATION</strong><a href="/docs/customization/overview.html" class="mobile-nav-link">Overview</a><a href="/docs/customization/userandworkspace.html" class="mobile-nav-link">User and Workspace Settings</a><a href="/docs/customization/locales.html" class="mobile-nav-link">Display Language</a><strong class="mobile-nav-title">LANGUAGES</strong><a href="/docs/languages/overview.html" class="mobile-nav-link">Overview</a><a href="/docs/languages/html.html" class="mobile-nav-link">HTML</a><strong class="mobile-nav-title">RUNTIMES</strong><a href="/hoge.html" class="mobile-nav-link">none</a><strong class="mobile-nav-title">EXTENSION AUTHORING</strong><a href="/hoge.html" class="mobile-nav-link">none</a><strong class="mobile-nav-title">EXTENSIBILITY REFERENCE</strong><a href="/hoge.html" class="mobile-nav-link">none</a><strong class="mobile-nav-title">SUPPORTING</strong><a href="/docs/supporting/errors.html" class="mobile-nav-link">Errors</a><a href="/docs/supporting/faq.html" class="mobile-nav-link">FAQ</a><a href="/docs/supporting/requirements.html" class="mobile-nav-link">Requirements</a><strong class="mobile-nav-title">TOOLS</strong><a href="/hoge.html" class="mobile-nav-link">none</a></div></nav><a id="scroll-to-top" role="button" aria-label="scroll to top" onclick="container.scrollTop=0"><span class="icon"></span></a><script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script><script src="/js/toc.js"></script><script src="/js/mobile_nav.js"></script><script src="/js/plugins.js"></script></body></html>